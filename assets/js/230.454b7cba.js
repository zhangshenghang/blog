(window.webpackJsonp=window.webpackJsonp||[]).push([[230],{707:function(a,e,t){"use strict";t.r(e);var s=t(20),r=Object(s.a)({},(function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("p",[t("a",{attrs:{href:"https://www.hadoop.wiki/pages/d3710b",target:"_blank",rel:"noopener noreferrer"}},[a._v("数据湖Iceberg-简介(1)"),t("OutboundLink")],1),a._v(" "),t("a",{attrs:{href:"https://www.hadoop.wiki/pages/ded150/",target:"_blank",rel:"noopener noreferrer"}},[a._v("数据湖Iceberg-存储结构(2)"),t("OutboundLink")],1),a._v(" "),t("a",{attrs:{href:"https://www.hadoop.wiki/pages/9a96a6/",target:"_blank",rel:"noopener noreferrer"}},[a._v("数据湖Iceberg-Hive集成Iceberg(3)"),t("OutboundLink")],1),a._v(" "),t("a",{attrs:{href:"https://www.hadoop.wiki/pages/592494/",target:"_blank",rel:"noopener noreferrer"}},[a._v("数据湖Iceberg-SparkSQL集成(4)"),t("OutboundLink")],1),a._v(" "),t("a",{attrs:{href:"https://www.hadoop.wiki/pages/12fe6d/",target:"_blank",rel:"noopener noreferrer"}},[a._v("数据湖Iceberg-FlinkSQL集成(5)"),t("OutboundLink")],1),a._v(" "),t("a",{attrs:{href:"https://www.hadoop.wiki/pages/edf0ba/",target:"_blank",rel:"noopener noreferrer"}},[a._v("数据湖Iceberg-FlinkSQL-kafka类型表数据无法成功写入(6)"),t("OutboundLink")],1),a._v(" "),t("a",{attrs:{href:"https://www.hadoop.wiki/pages/571843/",target:"_blank",rel:"noopener noreferrer"}},[a._v("数据湖Iceberg-Flink DataFrame集成(7)"),t("OutboundLink")],1)]),a._v(" "),t("h1",{attrs:{id:"数据湖iceberg-flinksql-kafka类型表数据无法成功写入"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据湖iceberg-flinksql-kafka类型表数据无法成功写入"}},[a._v("#")]),a._v(" 数据湖Iceberg-FlinkSQL-kafka类型表数据无法成功写入")]),a._v(" "),t("p",[a._v("数据湖Iceberg-FlinkSQL-kafka类型表数据无法成功写入版本问题问题原因解决方法")]),a._v(" "),t("h2",{attrs:{id:"版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#版本"}},[a._v("#")]),a._v(" 版本")]),a._v(" "),t("p",[a._v("Iceberg：1.1.0")]),a._v(" "),t("p",[a._v("Flink：1.14.3")]),a._v(" "),t("h2",{attrs:{id:"问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[a._v("#")]),a._v(" 问题")]),a._v(" "),t("p",[a._v("Kafka类型的Iceberg表创建完成后，通过语句写入其他表中执行成功，但是没数据")]),a._v(" "),t("h2",{attrs:{id:"问题原因"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#问题原因"}},[a._v("#")]),a._v(" 问题原因")]),a._v(" "),t("p",[a._v("当前版本的BUG（存疑）")]),a._v(" "),t("h2",{attrs:{id:"解决方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解决方法"}},[a._v("#")]),a._v(" 解决方法")]),a._v(" "),t("p",[a._v("Kafka表必须要在"),t("code",[a._v("default_catalog.default_database")]),a._v("下，即"),t("code",[a._v("catalog")]),a._v("名为"),t("code",[a._v("default_catalog")]),a._v("，数据库(命名空间)为"),t("code",[a._v("default_database")]),a._v("下,否则kafka类型的表读取不到数据。")]),a._v(" "),t("p",[a._v("如果都在我们自己创建的catalog下创建，则执行"),t("code",[a._v("INSERT INTO hadoop_catalog.iceberg_db.sample6 SELECT * FROM default_catalog.default_database.kafka1;")]),a._v("后,在Flink任务中看不到一个持续执行的Flink Job，而正常执行该命令Flink会执行一个持续执行的任务，去消费kafka数据写入Iceberg，正常情况如下图：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/04/24/wLyJ9QSNtBi7gUr.png",alt:"image-20230421171018370"}})]),a._v(" "),t("p",[a._v("所以这里我们kafka表在"),t("code",[a._v("default_catalog.default_database")]),a._v("下，写入数据的表在我们自己创建的"),t("code",[a._v("hadoop_catalog.iceberg_db")]),a._v("下")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("create table default_catalog.default_database.kafka1(\n  id int,\n  data string\n) with (\n  'connector' = 'kafka'\n  ,'topic' = 'ttt'\n  ,'properties.zookeeper.connect' = '172.16.24.194:2181'\n  ,'properties.bootstrap.servers' = '172.16.24.194:9092'\n  ,'format' = 'json'\n  ,'properties.group.id'='iceberg1'\n  ,'scan.startup.mode'='earliest-offset'\n);\n\nCREATE TABLE `hadoop_catalog`.`iceberg_db`.`sample6` (\n  `id`  INT UNIQUE COMMENT 'unique id',\n  `data` STRING NOT NULL,\n PRIMARY KEY(`id`) NOT ENFORCED\n) with (\n'format-version'='2', \n'write.upsert.enabled'='true'\n);\n\n\nINSERT INTO hadoop_catalog.iceberg_db.sample6 SELECT * FROM default_catalog.default_database.kafka1;\n\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br"),t("span",{staticClass:"line-number"},[a._v("22")]),t("br"),t("span",{staticClass:"line-number"},[a._v("23")]),t("br"),t("span",{staticClass:"line-number"},[a._v("24")]),t("br"),t("span",{staticClass:"line-number"},[a._v("25")]),t("br")])]),t("p",[a._v("此时我们往Kafka发送数据：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('{"id":123,"data":"llalalala"}\n{"id":1123,"data":"asdfasfds"}\n')])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("p",[a._v("查看表中数据可以看到写入成功")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("select * from hadoop_catalog.iceberg_db.sample6;\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/04/24/EIMZBJhVtnx4fWi.png",alt:"image-20230421171149990"}})]),a._v(" "),t("p",[a._v("再次发送数据")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('{"id":123,"data":"JastData"}\n')])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("查看表中数据,发现修改成功")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2023/04/24/iCSMOdzF9Q8xtHb.png",alt:"image-20230421171457655"}})])])}),[],!1,null,null,null);e.default=r.exports}}]);