(window.webpackJsonp=window.webpackJsonp||[]).push([[148],{626:function(s,a,t){"use strict";t.r(a);var n=t(20),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("[toc]")]),s._v(" "),t("h1",{attrs:{id:"前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),t("p",[s._v("之前我们介绍过单节点的ES快照、恢复，这里介绍一下集群的方式进行快照")]),s._v(" "),t("h2",{attrs:{id:"多台服务器共享快照目录挂载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#多台服务器共享快照目录挂载"}},[s._v("#")]),s._v(" 多台服务器共享快照目录挂载")]),s._v(" "),t("h3",{attrs:{id:"sshfs方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sshfs方式"}},[s._v("#")]),s._v(" SSHFS方式")]),s._v(" "),t("h4",{attrs:{id:"linux-es-用户调整"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#linux-es-用户调整"}},[s._v("#")]),s._v(" Linux es 用户调整")]),s._v(" "),t("p",[s._v("所有es使用的服务器进行es用户调整，保证es用户id与es用户组id相同，不相同可能会导致后期文件同步后权限不一致。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("官方GitHub地址")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v(" https://github.com/libfuse/sshfs/releases\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("安装")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y fuse-sshfs\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("blockquote",[t("p",[s._v("这里安装可能会提示"),t("code",[s._v("No package fuse-sshfs available.")])]),s._v(" "),t("p",[s._v("解决方法：")]),s._v(" "),t("p",[s._v("安装epel，执行")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rpm -Uvh https://mirrors.tuna.tsinghua.edu.cn/epel/epel-release-latest-7.noarch.rpm")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("其他版本epel在这里查看：https://mirrors.tuna.tsinghua.edu.cn/epel/")]),s._v(" "),t("p",[s._v("或者直接执行"),t("code",[s._v("yum -y install epel-release")]),s._v(" （该方法可能无法安装，推荐使用上面rpm安装）")])])]),s._v(" "),t("li",[t("p",[s._v("挂载远程目录")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("sshfs 远程服务器用户名@远程服务器ip:远程主机需要挂载到本地的目录 挂载到本地的目录\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v(" /opt/jast\nsshfs es@192.168.179.238:/opt/jast /opt/jast  -o allow_other\n\n -o allow_other 是给其他用户权限操作\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("此时再本机和"),t("code",[s._v("192.168.179.238")]),s._v("服务器上对"),t("code",[s._v("/opt/jast")]),s._v("目录数据进行删除新增文件都会"),t("strong",[s._v("双向同步")])])]),s._v(" "),t("li",[t("p",[s._v("多台服务器挂载远程目录")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("在三台服务器创建/opt/jast目录\n修改权限为：chmod "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v(" /opt/jast\n在A服务器执行\nsshfs root@172.16.99.14:/opt/jast /opt/jast -o allow_other\n在B服务器执行\nsshfs root@172.16.99.14:/opt/jast /opt/jast -o allow_other\n此时A、B服务器与172.16.99.14的/opt/jast目录之间已经实现共享\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[t("strong",[s._v("注意：")])]),s._v(" "),t("p",[s._v("要在A,B两台服务器分别挂载C服务器；在A "),t("code",[s._v("/opt/jast")]),s._v("分别挂载B和C的"),t("code",[s._v("/opt/jast")]),s._v("只能同步成功一个。")]),s._v(" "),t("p",[s._v("错误挂载：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("es@gz-a00-2 jast"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("df")]),s._v(" -h\nFilesystem                      Size  Used Avail Use% Mounted on\n/dev/vdb1                       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".4T  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9T  370G  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),s._v("% /opt\nroot@192.168.179.238:/opt/jast  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".4T  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".7T  560G  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("76")]),s._v("% /opt/jast\nroot@172.16.99.14:/opt/jast     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".4T  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".7T  560G  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("76")]),s._v("% /opt/jast\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("正确挂载：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@gz-a00-2 opt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# df -h")]),s._v("\nFilesystem                      Size  Used Avail Use% Mounted on\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nroot@192.168.179.238:/opt/jast  985G  765G  170G  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("82")]),s._v("% /opt/jast\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@gz-a00-1 jast"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# df -h")]),s._v("\nFilesystem                      Size  Used Avail Use% Mounted on\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nroot@192.168.179.238:/opt/jast  985G  765G  170G  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("82")]),s._v("% /opt/jast\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("卸载挂载")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v(" fusermount -u /opt/jast\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("强制卸载")]),s._v(" "),t("p",[s._v("如果"),t("code",[s._v("fusermount")]),s._v("无法卸载可以使用"),t("code",[s._v("umount")]),s._v("命令进行卸载")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("umount")]),s._v(" -fl /opt/jast\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])]),s._v(" "),t("h2",{attrs:{id:"elasticsearch-设置备份文件地址"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch-设置备份文件地址"}},[s._v("#")]),s._v(" ElasticSearch 设置备份文件地址")]),s._v(" "),t("ul",[t("li",[s._v("在elasticsearch.yml 新增\n"),t("code",[s._v("/opt/jast_s")]),s._v("是我们新增的快照地址，"),t("code",[s._v("/opt/es/snapshot")]),s._v("是之前配置的，这里我们不用，直接忽略。")])]),s._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path.repo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/es/snapshot"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/jast_s"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"注册快照存储库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注册快照存储库"}},[s._v("#")]),s._v(" 注册快照存储库")]),s._v(" "),t("p",[t("code",[s._v("jastsnapshot")]),s._v("使我们快照存储库名称")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("PUT _snapshot/jastsnapshot\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fs"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"settings"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"compress"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"location"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/jast_s"')]),s._v("      \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h2",{attrs:{id:"查看快照存储库保存结果"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看快照存储库保存结果"}},[s._v("#")]),s._v(" 查看快照存储库保存结果")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("GET _snapshot\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ecopherebbs"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fs"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"settings"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"location"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/es/snapshot"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jastsnapshot"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fs"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"settings"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"compress"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"location"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/jast_s"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("ol",[t("li",[s._v("linux用户组设置")]),s._v(" "),t("li",[s._v("共享目录——启动要使用es用户，否则目录权限不对，做快照会提示权限问题。切记！！！")])])])}),[],!1,null,null,null);a.default=e.exports}}]);