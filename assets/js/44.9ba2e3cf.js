(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{522:function(s,a,t){"use strict";t.r(a);var n=t(20),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("[toc]")]),s._v(" "),t("h1",{attrs:{id:"个人邮箱信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#个人邮箱信息"}},[s._v("#")]),s._v(" 个人邮箱信息")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'set from=806666800@qq.com'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("/etc/mail.rc\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'set smtp=smtps://smtp.qq.com:465'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("/etc/mail.rc\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'set smtp-auth-user=806666800@qq.com'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("/etc/mail.rc\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'set smtp-auth-password=jbguyqasdljwbaji'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("/etc/mail.rc "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这里用的是授权码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'set smtp-auth=login'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("/etc/mail.rc\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h1",{attrs:{id:"shell脚本-linux进程-端口监控邮件预警"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#shell脚本-linux进程-端口监控邮件预警"}},[s._v("#")]),s._v(" [Shell脚本]Linux进程/端口监控邮件预警")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("#! /bin/bash\n#监听特定服务，当服务挂掉之后发送邮件至监听邮箱内.\n# 监控类型"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("服务进程"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("端口监听\nmonitor_type="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n# 服务进程信息 与 服务说明定义 / 服务端口监听信息 与 服务说明定义\ndeclare -A serverInfo\n#serverInfo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"YDService"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"云盘服务"')]),s._v("\n#serverInfo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"YD.S.1jf"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"测试服务"')]),s._v("\nserverInfo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"80"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"云盘服务"')]),s._v("\nserverInfo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8080"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"测试服务"')]),s._v("\n# 邮件接收人信息"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("多个邮箱逗号分隔\nreceiving_mail="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("745925668")]),s._v("@qq.com"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("745925668")]),s._v("@qq.com\n# 正文内容\nreceiving_content="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"请及时排查问题!"')]),s._v("\n# 休眠时间"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("单位秒\nsleepTime="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\n# 获取当前服务器ip\nserviceIp=$(ip addr | awk '/^"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-9")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("+"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" / "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("; /inet.*global/ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("print gensub(/(.*)\\/(.*)/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\\\\1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"g"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" $"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(")"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("')\n# 服务器hostname\nserviceHostName=$(hostname)\n# 检查并更新mail服务\nfunction update_mailx() "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    mail=`whereis mailx | grep  gz`\n    echo "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"${mail}"')]),s._v("\n    if "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -z "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"${mail}"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("; then\n      yum install -y mailx\n      else\n        echo "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mail is installed"')]),s._v("\n    fi\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n# 检查并更新mail配置信息"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("设置我们发送邮件的邮箱配置\nfunction set_mail_param() "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  param_set=`cat /etc/mail.rc | grep "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"smtp-auth-user=806666800@qq.com"')]),s._v("`\n  if "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -z "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"${param_set}"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("; then\n      echo 'set from="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("806666800")]),s._v("@qq.com' >>/etc/mail.rc\n      echo 'set smtp=smtp.exmail.qq.com' >>/etc/mail.rc\n      echo 'set smtp-auth-user="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("806666800")]),s._v("@qq.com' >>/etc/mail.rc\n      echo 'set smtp-auth-password=j3i5wQigoE9R28Po' >>/etc/mail.rc #这里用的是授权码\n      echo 'set smtp-auth=login' >>/etc/mail.rc\n    else\n    echo "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mail profile already set!"')]),s._v("\n  fi\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n#监听并发送邮件信息\nfunction monitor() "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  while "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("; do\n  for key in $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("!serverInfo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("*"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(";do\n  if "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("monitor_type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" -eq "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("; then\n    process_running=`netstat -antp |grep -w $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" |grep -w LISTEN|wc -l`\n  else\n    process_running=`ps -ef |grep $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("|grep -v grep|wc -l`\n  fi\n    if "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("  $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("process_running"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" -le "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("; then\n      echo $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" process  is not exist"')]),s._v("\n      send_mail $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("serverInfo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("$key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      #kill_process\n    else\n      echo $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" process is exist"')]),s._v("\n    fi\n    sleep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  done\n      sleep $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("sleepTime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  done\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n#发送邮件\nfunction send_mail() "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  OLD_IFS="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$IFS"')]),s._v("\n  IFS="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('","')]),s._v("\n  arr=($"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("receiving_mail"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(")\n  IFS="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$OLD_IFS"')]),s._v("\n  for user_mail in $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("arr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  do\n     echo $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("user_mail"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n     echo "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"服务器IP:${serviceIp}；服务器:${serviceHostName}；${receiving_content}"')]),s._v(" |   mail -s "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"严重 ${1} ${2} 服务/端口异常"')]),s._v("  $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("user_mail"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  done\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n#删除当前进程\nfunction kill_process() "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  kill "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-9")]),s._v(" $$\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nupdate_mailx\nset_mail_param\nmonitor\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br")])]),t("h1",{attrs:{id:"shell脚本-linux监控服务器磁盘空间邮件预警"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#shell脚本-linux监控服务器磁盘空间邮件预警"}},[s._v("#")]),s._v(" [Shell脚本]Linux监控服务器磁盘空间邮件预警")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#! /bin/bash")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监听服务器磁盘，超过百分比进行预警")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("alert_percent")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 邮件接收人信息,多个邮箱逗号分隔")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("receiving_mail")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("745925668")]),s._v("@qq.com,zhangsh@rbtsoft.com\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 正文内容")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("receiving_content")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("df")]),s._v(" -h"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('请及时排查问题!"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 休眠时间,单位秒")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sleepTime")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取当前服务器ip")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("serviceIp")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" addr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" '/^"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-9"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("+: / "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" /inet.*global/ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("print gensub"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(".*"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(".*"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("/, "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v('1"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"g"')]),s._v(", $2"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\')\n# 服务器hostname\nserviceHostName=$(hostname)\n# 执行时间\nrun_time="["`date "+%y-%m-%d %H:%M:%S"`"]"\n# 检查并更新mail服务\nfunction update_mailx() {\n    mail=`whereis mailx | grep  gz`\n    echo "$run_time${mail}"\n    if [ -z "${mail}"  ]; then\n      yum install -y mailx\n      else\n        echo $run_time"mail is installed"\n    fi\n}\n# 检查并更新mail配置信息,设置我们发送邮件的邮箱配置\nfunction set_mail_param() {\n  param_set=`cat /etc/mail.rc | grep "smtp-auth-user=admin@rbtsoft.com"`\n  if [ -z "${param_set}" ]; then\n      echo \'')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("from")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin@rbtsoft.com"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' >>/etc/mail.rc\n      # 个人QQ邮箱修改为\n      #  echo '")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("smtp")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("smtps://smtp.qq.com:465"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' >>/etc/mail.rc\n      echo '")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("smtp")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("smtp.exmail.qq.com"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' >>/etc/mail.rc\n      echo '")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" smtp-auth-user"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin@rbtsoft.com"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' >>/etc/mail.rc\n      echo '")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" smtp-auth-password"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("j3i5wQigoE9R28Po"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' >>/etc/mail.rc #这里用的是授权码\n      echo '")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" smtp-auth"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("login"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' >>/etc/mail.rc\n    else\n    echo  $run_time\"mail profile already set!\"\n  fi\n}\n#监听并发送邮件信息\nfunction monitor() {\n  isSend=0\n  for d in `df -P | grep /dev | awk '")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("print "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' | cut -f 1 -d \"%\"`\n    do\n      if [ $d -gt $alert_percent ]\n          then\n\t  isSend=1 \n      fi\n    done\n  \n  if [ $isSend -eq 1 ];then\n    echo $run_time'")]),s._v("disk use monitor'\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("content")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("df")]),s._v(" -h"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n    send_mail "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"磁盘空间使用率超过阈值"')]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$alert_percent")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发送邮件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("send_mail")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("OLD_IFS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$IFS")]),s._v('"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("IFS")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('","')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("arr")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${receiving_mail}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("IFS")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$OLD_IFS")]),s._v('"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("user_mail")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${arr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$run_time")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${user_mail}")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"服务器IP:'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${serviceIp}")]),s._v("；服务器:"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${serviceHostName}")]),s._v("；"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${receiving_content}")]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   mail -s "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"严重 '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${1}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${2}")]),s._v(' "')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${user_mail}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除当前进程")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("kill_process")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" -9 "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$$")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nupdate_mailx\nset_mail_param\nmonitor\n\n\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br")])]),t("h1",{attrs:{id:"阿里云无法成功发送邮件问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#阿里云无法成功发送邮件问题"}},[s._v("#")]),s._v(" 阿里云无法成功发送邮件问题")]),s._v(" "),t("h3",{attrs:{id:"异常"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#异常"}},[s._v("#")]),s._v(" 异常")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('[root@iZ2zeay5b02uru9p0lb63bZ ~]# could not connect: Network is unreachable\n"/root/dead.letter" 22/940\n. . . message not sent.\ncould not connect: Network is unreachable\n"/root/dead.letter" 22/930\n. . . message not sent.\ncould not connect: Connection timed out\n"/root/dead.letter" 22/940\n. . . message not sent.\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h3",{attrs:{id:"解决方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解决方法"}},[s._v("#")]),s._v(" 解决方法")]),s._v(" "),t("p",[s._v("安装"),t("code",[s._v("certutil")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libnss3-tools\n    -or-\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nss-tools\n    -or-\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" pacman -S nss\n    -or-\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("zypper")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" mozilla-nss-tools\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@myserver ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir -p /root/.certs/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@myserver ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo -n | openssl s_client -connect smtp.qq.com:465 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' > ~/.certs/qq2.crt")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("depth")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" C "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" BE, O "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" GlobalSign nv-sa, OU "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Root CA, CN "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" GlobalSign Root CA\nverify return:1\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("depth")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" C "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" BE, O "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" GlobalSign nv-sa, CN "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" GlobalSign Organization Validation CA - SHA256 - G2\nverify return:1\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("depth")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" C "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" CN, ST "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" guangdong, L "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" shenzhen, O "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Shenzhen Tencent Computer Systems Company Limited, CN "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" *.mail.qq.com\nverify return:1\nDONE\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@myserver ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@myserver ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# certutil -A -n "GeoTrust SSL CA" -t "C,," -d ~/.certs -i ~/.certs/qq2.crt')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@myserver ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# certutil -A -n "GeoTrust Global CA" -t "C,," -d ~/.certs -i ~/.certs/qq2.crt')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@myserver ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# certutil -L -d /root/.certs")]),s._v("\n\nCertificate Nickname                                         Trust Attributes\n                                                             SSL,S/MIME,JAR/XPI\n\nGeoTrust SSL CA                                              C,,\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@myserver ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo “邮件内容”|mail -s 标题 12345678@qq.com")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@myserver ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Error in certificate: Peer's certificate issuer has been marked as not trusted by the.")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@myserver .certs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# certutil -A -n "GeoTrust SSL CA - G3" -t "Pu,Pu,Pu" -d ./ -i qq2.crt')]),s._v("\nNotice: Trust flag u is "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" automatically "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" the private key is present.\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@myserver ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo “邮件内容”|mail -s 标题 12345678@qq.com")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("h3",{attrs:{id:"异常二"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#异常二"}},[s._v("#")]),s._v(" 异常二")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@iZ2zeay5b02uru9p0lb63bZ ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Unexpected EOF on SMTP connection")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/root/dead.letter"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("/930\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" message not sent.\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"解决方法-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解决方法-2"}},[s._v("#")]),s._v(" 解决方法")]),s._v(" "),t("p",[s._v("之前配置是")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("smtp")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("smtp.qq.com:465\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("改为")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("smtp")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("smtps://smtp.qq.com:465\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);